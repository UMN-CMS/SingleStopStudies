\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{umnslides}[2023/02/12 UMN Slides]
\newif\ifincludelogo\includelogofalse
\newif\ifheaderslides\headerslidesfalse
\DeclareOption{logo}{\includelogotrue}
\DeclareOption{headerslides}{\headerslidestrue}
\DeclareOption*{\PackageWarning{umnslides}{Unknown `\CurrentOption`}}
\ProcessOptions\relax
\date{2024-05-01}

\RequirePackage{hyperref}
\RequirePackage{umnparticles}
\hypersetup{colorlinks=true, linkcolor=blue, filecolor=blue, citecolor = black, urlcolor=cyan}
\RequirePackage{umncolors}
\RequirePackage{pgfplots}
\usepgfplotslibrary{fillbetween}

\RequirePackage{tikz}
\usetikzlibrary{fit,positioning,calc,shapes,backgrounds}
\usetikzlibrary{shapes.geometric, arrows}

\colorlet{nowork}{red!100!green}
\colorlet{prelim}{red!60!green}
\colorlet{working}{red!30!green}
\colorlet{ready}{red!0!green}



\RequirePackage{etoolbox}
\RequirePackage{mathtools}
\RequirePackage{graphicx}


% \definecolor{links}{HTML}{2A1B81}
% \hypersetup{colorlinks,linkcolor=,urlcolor=links}

\usebeamertemplate{madrid}
\useinnertheme{circles}
\useoutertheme[subsection=false]{miniframes}
\ifheaderslides
  \AtBeginSection[]{
    \begin{frame}
      \vfill
      \centering
      \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
        {
          \hypersetup{allcolors=.}
          \usebeamerfont{title}\insertsection\par%
        }
      \end{beamercolorbox}
      \vfill
    \end{frame}
  }
\fi

\setbeamercolor{frametitle}{fg = UMNGold, bg = UMNMaroon }
\setbeamercolor{title}{fg = UMNGold, bg = UMNMaroon }
\setbeamercolor{author in head/foot}{fg = UMNGold, bg = UMNDarkMaroon }
\setbeamercolor{title in head/foot}{fg = UMNGold, bg = UMNMaroon}
\setbeamercolor{date in head/foot}{fg = UMNGold, bg = UMNLightMaroon}
\setbeamercolor{section in head/foot}{fg = UMNGold, bg = UMNLightMaroon}
\setbeamercolor{button}{bg=UMNMaroon,fg=UMNGold}
\setbeamerfont{footnote}{size=\tiny}
\setbeamersize{text margin left=4mm,text margin right=6mm}
\setbeamertemplate{navigation symbols}{} % To remove the navigation symbols from the bottom of all slides
\setbeamertemplate{enumerate items}[default]%
\setbeamercolor{itemize item}{fg = UMNMaroon}
\setbeamercolor{itemize subitem}{fg = black}
\setbeamercolor{itemize subsubitem}{fg = UMNMaroon}
\setbeamercolor{enumerate item}{bg = UMNMaroon}
\setbeamercolor{enumerate subitem}{fg = UMNStormy, bg = black}
\setbeamercolor{enumerate subsubitem}{bg = UMNMaroon}

\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}[triangle]
\setbeamertemplate{itemize subsubitem}{\raisebox{-0.4em}{\scalebox{3.0}{$\cdot$}}}

\setbeamercolor{block title}{use=structure,fg=white,bg=structure.fg!75!black}
\setbeamercolor{block body}{parent=normal text,use=block title,bg=block title.bg!10!bg}


% \setbeamertemplate{itemize/enumerate body begin}{\footnotesize}
\setbeamertemplate{itemize/enumerate subbody begin}{\scriptsize}
\setbeamertemplate{itemize/enumerate subsubbody begin}{\tiny}
\ifincludelogo
  \titlegraphic{\includegraphics[width=2cm]{goldy.png}}
  % \makeatletter
  % \defbeamertemplate*{frametitle}{umnbasic}[1][left]{
  % \ifbeamercolorempty[bg]{frametitle}{}{\nointerlineskip}%
  %   \@tempdima=\textwidth%
  %   \advance\@tempdima by\beamer@leftmargin%
  %   \advance\@tempdima by\beamer@rightmargin %
  %   \begin{beamercolorbox}[sep=0.3cm,left,wd=\the\@tempdima]{frametitle}%
  %     \usebeamerfont{frametitle}%
  %     \vbox{}\vskip-1ex%
  %     \if@tempswa\else\csname beamer@fteleft\endcsname\fi%
  %     \strut\insertframetitle\strut{\includegraphics[width=0.5cm]{goldy.png}}\par%
  %     {%
  %     \ifx\insertframesubtitle\@empty%
  %     \else%
  %       {\usebeamerfont{framesubtitle}\usebeamercolor[fg]{framesubtitle}\strut\insertframesubtitle\strut\par}%
  %     \fi
  %   }%
  %     \vskip-1ex%
  %     \if@tempswa\else\vskip-.3cm\fi% set inside beamercolorbox... evil here...
  %   \end{beamercolorbox}%
  % }
  %   \makeatother
  %   \usebeamertemplate{frametitle}[umnbasic]
\fi
\addtobeamertemplate{headline}{\hypersetup{allcolors={}}}{}
\setbeamertemplate{footline}
{
  \leavevmode%
  \hbox{%
    \hypersetup{allcolors={}}%
    \begin{beamercolorbox}[wd=.33333\paperwidth,ht=2.25ex,dp=1ex,center]{date in head/foot}%
      \usebeamerfont{author in head/foot}\insertshortauthor
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,center]{date in head/foot}%
      \usebeamerfont{title in head/foot}\insertshorttitle{} -- \insertsectionhead
    \end{beamercolorbox}%
    \begin{beamercolorbox}[wd=.333333\paperwidth,ht=2.25ex,dp=1ex,right]{date in head/foot}%
      \usebeamerfont{date in head/foot}\insertshortdate{}\hspace*{2em}
      \insertframenumber{} / \inserttotalframenumber\hspace*{2ex} 
    \end{beamercolorbox}}%
  \vskip0pt%
}
% \setbeamertemplate{footline}
% {
% \leavevmode%
% \begin{beamercolorbox}[wd=\paperwidth,ht=2.25ex,dp=1ex]{date in head/foot}%
%   \usebeamerfont{author in head/foot} %\insertshortdate{}\hspace*{2em}
%   \insertauthor
%   \hfill
%   \inserttitle
%   \hill
%   \usebeamerfont{date in head/foot} \insertshortdate{}\hspace*{2em}
%   \insertframenumber{} / \inserttotalframenumber\hspace*{3ex} 
% \end{beamercolorbox}%
% \vskip0pt%
% }


\newenvironment{halfcol}{\begin{column}{0.5\textwidth}}{\end{column}}
% \renewenvironment{twocol}{ 
% \newdimen\splitterdimen{0.5\textwidth}
% \def\splitcols{\end{column} \begin{column}{\splitterdimen}}
% \begin{columns} \begin{column}{\splitterdimen}
%   }{
%   \end{column}\end{columns}
% }



\makeatletter
\newcounter{col@Counter}
\newenvironment{splitcol}[1][0.5]{
  \begin{columns}
    \setcounter{col@Counter}{0}
    \newdimen\colOneDim
    \colOneDim=\dimexpr #1\textwidth \relax
    \newdimen\colTwoDim
    \colTwoDim=\dimexpr\textwidth-\colOneDim\relax
    \newenvironment{col}{
      \begin{column}{\ifnum\value{col@Counter}=0 \colOneDim \else \colTwoDim \fi}
      }{
      \end{column}
      \setcounter{col@Counter}{1}
    }
  }{
  \end{columns}
}
\makeatother

\colorlet{mylightblue}{blue!60!cyan!80!black!15}
\colorlet{mypurple}{blue!50!red!70}
\colorlet{gaugecol}{red!90!black!70} % Wiki red
\colorlet{leptoncol}{green!80!black!70} % Wiki green
\colorlet{quarkcol}{blue!85!cyan!95!black!55} % Wiki purple
\colorlet{quarkred}{red!98!black!55} % quark red
\colorlet{quarkblue}{blue!85!cyan!98!black!55} % quark blue
\colorlet{quarkgreen}{green!95!black!55} % quark green
\colorlet{gluoncyan}{cyan!100!black!55} % gluon cyan
\colorlet{gluongreen}{green!75!blue!95!black!70} % gluon green
\colorlet{gluonyellow}{yellow!98!black!55} % gluon yellow
\colorlet{gluonorange}{orange!100!black!65} % gluon orange
\colorlet{gluonmagenta}{magenta!100!black!70} % gluon magenta
\colorlet{scalarcol}{yellow!70!orange!98!black}
\colorlet{tensorcol}{blue!50!red!70} % Wiki light blue
\colorlet{groupcol}{orange!15}



\newcommand{\blockcite}[2]{
  \begin{tikzpicture}
    \node[inner sep=0pt,anchor=south west] at (0,0) {#1};
    \node[anchor=north west] at (0,0) {\tiny #2};
  \end{tikzpicture}
}

\newcommand{\graphiccite}[3]{
  \blockcite{\includegraphics[width=#2\textwidth]{#1}}{\textbf{Source}: \cite{#3}}
}


\newcommand{\coloreditem}[1]{\item[{\tikz[]{\draw[fill=#1] circle (0.25em);}}]}

\newcommand{\mypos}[1]{\tikz[baseline, remember picture]{\coordinate[inner sep=0pt, anchor=base](#1);}}

\pgfmathsetmacro{\myinnersep}{2}% inner sep in mm
\newsavebox{\annotbox}
\newlength{\markpossep}
\setlength{\markpossep}{1pt}

\newcommand{\markpos}[2]{
  \ifmmode %
    \sbox{\annotbox}{$\displaystyle\relax#2$} %
  \else %
    \sbox{\annotbox}{#2} %
  \fi %
  {#2}\kern\dimexpr - \wd\annotbox - \markpossep \relax%
  \tikz[remember picture, baseline=-2pt]{
    \node[inner sep=0pt, anchor=base,
    %fill=red,opacity=0.2,
    minimum width=\dimexpr\wd\annotbox + 2\markpossep\relax,
    minimum height=\dimexpr \ht\annotbox+\dp\annotbox+2\markpossep\relax] (#1) {};} 
}

\newcommand{\posannot}[4][60:1cm]{
  \begin{tikzpicture}[overlay, remember picture]
    \node[#3, align=center] (annot) at ($(#2) +(#1)$) {#4};
    \draw[->, thick] (annot) -- (#2);
  \end{tikzpicture}
}


\newenvironment{annotimage}[1]{
  \begin{tikzpicture}[remember picture]
    \node[anchor=south west,inner sep=0] (image) at (0,0) {#1};
    \begin{scope}[x={(image.south east)},y={(image.north west)}]
    }{
    \end{scope} \end{tikzpicture}
}


\newenvironment{beamerpopover}{
  \begin{tikzpicture}[overlay,remember picture]
    \pgftransformshift{\pgfpointanchor{current page}{center}}
    \node[align=center, anchor=center,
    text width=\textwidth %
    ] at (0,0) %
    \bgroup %
  }{\egroup ; %
  \end{tikzpicture} %
}

\newcommand{\markimage}[3]{
  \begin{tikzpicture}[remember picture]
    \node[anchor=south west,inner sep=0] (image) at (0,0) {#1};
    \begin{scope}[x={(image.south east)},y={(image.north west)}]
      \coordinate (#3) at (#2);
    \end{scope}
  \end{tikzpicture}
}


\def\compparseddatelater#1-#2-#3\otherdate#4-#5-#6\enddate{
  \ifnum#1=#4 %
    \ifnum#2=#5 %
      \ifnum#3=#6 %
        1 %
      \else  %
        \ifnum #3>#6  %
          1 %
        \else %
          0 %
        \fi %
      \fi %
    \else  %
      \ifnum #2>#5  %
        1 %
      \else %
        0 %
      \fi %
    \fi %
  \else %
    \ifnum #1>#4  %
      1  %
    \else %
      0 %
    \fi %
  \fi
}

\makeatletter
\def\parseddatelater#1-#2-#3\enddate {
  \expandafter\compparseddatelater\beamer@shortdate\otherdate#1-#2-#3\enddate
}
\makeatother

\newcommand{\ifdatelater}[1]{
    \edef\islater{\expandafter\parseddatelater#1\enddate}
    \expandafter\ifnum\islater=1
    }

    \newcommand\prevtalk[2]{
      \ifdatelater{#1} \item #2 \fi
    }

    \endinput
